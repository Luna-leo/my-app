# 選択的カラム読み込み機能

## 概要
データベースから必要なカラムのみを選択的に読み込む機能を実装しました。これにより、大規模データセットのメモリ使用量を大幅に削減できます。

## 実装内容

### 1. IndexedDB層の更新
- `lib/db/index.ts`の`getTimeSeriesData`メソッドに`parameterIds`オプションを追加
- ストリーミング関数（`streamTimeSeriesData`、`streamMultipleTimeSeriesData`）も同様に更新

### 2. ChartDataContextの更新
- `contexts/ChartDataContext.tsx`で必要なパラメータIDを事前に収集
- データ取得時に必要なカラムのみを読み込むよう修正
- キャッシュキーを`metadataId-parameterIds`形式に変更

### 3. キャッシュシステムの更新
- `lib/services/dataCache.ts`の`timeSeriesCache`が文字列キーをサポート

## パフォーマンス改善

### メモリ使用量の削減
- **改善率**: 使用カラム数に比例（例: 16/100カラム使用なら84%削減）
- **実測例**: 500,000データポイント × 100カラム → 500,000データポイント × 16カラム

### 読み込み速度の向上
- **期待値**: 30-50%の改善（I/O量削減による）
- データ転送量の削減によりネットワーク負荷も軽減

## 使用方法
選択的カラム読み込みは自動的に有効になります。チャート作成時に必要なパラメータのみが読み込まれます。

## 今後の改善案
1. Parquetファイルの列投影（column projection）機能の実装
2. CSVファイルの選択的カラム読み込み
3. より詳細なメモリ使用量の計測とモニタリング